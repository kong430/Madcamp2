
# 이게모게

> 장진혁, 박민경



### Overview

> 채팅 기능, 그림 공유가 가능한 어플리케이션이다. 턴재로 진행되는 게임이며, 상대방이 그린 그림을 맞추면 된다. 



### Environment

* Android Studio 4.2.1
* SDK Platforms: Android 11.0 - API Level: 30
* Language : JAVA, JavaScript
* Node.js : 16.4.2



### Login

> 카카오 계정으로 로그인을 한다.

* Kakao SDK를 이용하여 API를 호출해 구현하였다. 카카오 로그인 버튼을 누르게 되면, 초기에는 카카오 이메일로 로그인을 하게 되며 사용자 이름, 프로필 사진 제공 동의 후 대기실로 화면이 전환된다.


<img src="https://user-images.githubusercontent.com/86706527/125457858-6d57b695-5787-4d72-946d-df8be43640c0.jpg" width="311" height="640">





### Waiting

> 상대방을 기다리는 동안 띄워지는 화면, 게임이 시작되기 위해 필요한 인원수가 채워질 때까지 띄워진다. 

- 클라이언트를 새로 생성하여 서버와 연결된 상태이다.

- 서버는 클라이언트가 연결될 때마다 리스트에 저장을 하고 있으며, 리스트의 길이가 특정 임계치(이 게임의 경우 3)를 넘어야 게임을 시작한다.



### Game

> 가장 먼저 참가한 사람부터 문제를 출제하게 된다. 규칙은 단순하다. 문제를 출제하는 사람은 서버에서 제공해준 단어를 캔버스에 그리면 된다. 이 그림은 이 게임을 사용하는 다른 사람들 모두에게 보이나 단어는 보이지 않는다. 다른 사람들은 문제를 출제한 사람이 본 단어를 맞추면 된다.


* 서버는 리스트에 있는 클라이언트를 순서대로 차례를 지정한다. 

  * 지정된 클라이언트는 서버에 있는 단어를 하나 받게 된다.

  * 타이머를 시작하며 각 클라이언트에게 시작을 했다는 신호를 준다.
  * 15초 동안 그림을 그릴 시간을 주고 채팅을 통해 맞출 수 있게 한다. 
* 채팅을 치게 되면 이름과 채팅 내용을 서버에 보낸다. 채팅 내용은 string과 image 두 가지로 나뉜다. 각 내용에 따라 다른 JSON object에 넣게 되고 서버에서 보낸 사람 이외의 다른 클라이언트에게 그대로 보낸다. 이 채팅을 받게 된 클라이언트는 채팅 내용이 string인지 image인지를 분류하게 되고, 분류한 결과에 따라 RecyclerView에 맞는 ViewHolder에 넣는다. 
  * 정답을 맞추게 되면, 타이머에 남은 시간과 관계 없이 턴이 넘어가고, 각 클라이언트의 점수에 반영이 된다.  
* 그림 그리기 기능은 Canvas를 이용하여 구현하였다. webSocket을 이용하여 함께 접속해 있는 상대에게 나의 캔버스가 실시간으로 공유된다.
  * floatingButton으로 새로고침, 펜 모드, 지우개 모드를 선택할 수 있다.
  * 그림을 그리기 위해 터치하는 좌표, paint의 색, 선의 두께를 속성으로 가지는 Pen class를 정의한다.
  * canvas의 drawLine 함수를 호출하여 터치이벤트가 일어날때마다 Pen 타입 리스트에 객체를 추가하며 동시에 canvas에 그림을 그리고, 실시간 공유를 위해 jsonObject로 펜 객체의 속성을 담아 보낸다.
  * 받은 jsonObject를 저장하기 위해 상대방은 새로운 Pen 타입 리스트를 정의하고, 받을 때마다 객체를 추가하여 drawLine 함수가 호출되도록 한다. 

![KakaoTalk_20210714_003748789](https://user-images.githubusercontent.com/86706527/125482331-fdd95a48-d828-4e5e-95c7-85a34034d014.gif)
![KakaoTalk_20210714_003748789_01](https://user-images.githubusercontent.com/86706527/125482440-3cd288ca-fa85-4c21-b32e-176d9812c1f5.gif)

